<!DOCTYPE html>
<html>
<head>
    <title>å€™è£œæ—¥ç¢ºå®š</title>
    <link rel="stylesheet" href="/static/style.css">

    <style>
        .tab-buttons { margin-bottom: 20px; }
        .tab-buttons button {
            padding: 10px 15px; margin-right: 5px;
            cursor: pointer; border: 1px solid #333;
            background: #f0f0f0;
        }
        .tab-buttons button.active { background: #3498db; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .date-large { font-size: 20px; font-weight: bold; }
        .confirmed { background: #c5ffc8; }
    </style>

    <script>
        function showTab(key) {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            document.querySelector(`#tab-${key}`).classList.add('active');

            document.querySelectorAll('.tab-buttons button').forEach(e => e.classList.remove('active'));
            document.querySelector(`#btn-${key}`).classList.add('active');
        }
    </script>
</head>
<body>

<h1>æ—¥ç¨‹ç®¡ç†</h1>

<!-- ğŸ”¹ ã‚¿ãƒ–ãƒœã‚¿ãƒ³ï¼ˆæœˆã®ã¿è¡¨ç¤º / ä¸¦ã³é †ã¯12æœˆ2025â†’1æœˆ2026â€¦ï¼‰ -->
<div class="tab-buttons">
    {% for tab in month_tabs %}
        <button id="btn-{{ tab.key }}" onclick="showTab('{{ tab.key }}')" {% if loop.first %}class="active"{% endif %}>
            {{ tab.label }}
        </button>
    {% endfor %}
</div>

<!-- ğŸ”¹ æœˆã”ã¨ã®å†…å®¹ -->
{% for tab in month_tabs %}
<div id="tab-{{ tab.key }}" class="tab-content {% if loop.first %}active{% endif %}">

    <h2>{{ tab.label }}ã®å€™è£œæ—¥ä¸€è¦§</h2>
    <table border="1">
        <tr>
            <th>æ—¥ä»˜</th><th>ä½“è‚²é¤¨</th><th>æ™‚é–“</th>
            <th>ç¢ºå®š</th><th>ç·¨é›†</th><th>å‰Šé™¤</th>
        </tr>

        {% for c in candidates_by_month.get(tab.month, []) %}
        <tr class="{% if c.id in confirmed_ids %}confirmed{% endif %}">
            <td class="date-large">{{ c.md }}</td>
            <td>{{ c.gym }}</td>
            <td>{{ c.start }}ã€œ{{ c.end }}</td>

            <td>
                {% if c.id in confirmed_ids %}
                    <form method="POST" action="{{ url_for('unconfirm', candidate_id=c.id) }}">
                        <button style="background:#e67e22; color:white;">ç¢ºå®šè§£é™¤</button>
                    </form>
                {% else %}
                    <form method="POST" action="{{ url_for('confirm') }}">
                        <input type="hidden" name="candidate_id" value="{{ c.id }}">
                        <button>ç¢ºå®š</button>
                    </form>
                {% endif %}
            </td>

            <td>
                <form method="GET" action="{{ url_for('edit_candidate', id=c.id) }}">
                    <button>ç·¨é›†</button>
                </form>
            </td>

            <td>
                <form method="POST" action="{{ url_for('delete_candidate', id=c.id) }}">
                    <button onclick="return confirm('ã“ã®å€™è£œæ—¥ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">å‰Šé™¤</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>

    <br><hr>

    <h2>{{ tab.label }}ã®ç¢ºå®šæ¸ˆã¿æ—¥ç¨‹</h2>
    <table border="1">
        <tr>
            <th>æ—¥ä»˜</th><th>ä½“è‚²é¤¨</th><th>æ™‚é–“</th>
            <th>å‚åŠ äººæ•°</th><th>ä¸å‚åŠ äººæ•°</th>
            <th>å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼</th><th>ä¸å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼</th>
            <th>ç·¨é›†</th>
        </tr>

        {% for confirm, c in confirmed_by_month.get(tab.month, []) %}
            {% set summary = attendance_summary.get(confirm.id, {}) %}
            <tr>
                <td class="date-large">{{ c.md }}</td>
                <td>{{ c.gym }}</td>
                <td>{{ c.start }}ã€œ{{ c.end }}</td>
                <td>{{ summary.attend_count or 0 }}</td>
                <td>{{ summary.absent_count or 0 }}</td>
                <td>{{ summary.attend_members | join(", ") if summary.attend_members else "-" }}</td>
                <td>{{ summary.absent_members | join(", ") if summary.absent_members else "-" }}</td>
                <td>
                    <a href="{{ url_for('manage_event_attendance', event_id=confirm.id) }}" class="btn">å‚åŠ è€…ç·¨é›†</a>
                </td>
            </tr>
        {% endfor %}
    </table>

</div>
{% endfor %}

<br>
<a href="{{ url_for('admin_menu') }}">ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</a>

</body>
</html>
